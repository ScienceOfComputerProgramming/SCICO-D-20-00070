#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Script that contains the operation to be done
 after a commit is made. This script builds the 
 issues from the commit made and stores it in our
 issue repository

:@author: Nystrom Edwards
:Created: 12 July 2018
"""
from sciit import IssueRepo, IssueTree, IssueCommit
from sciit.tree import find_issues_in_tree
from sciit.functions import write_last_issue
from termcolor import colored
import colorama

colorama.init()
repo = IssueRepo()
commit = repo.head.commit
issues = find_issues_in_tree(repo, commit.tree)
itree = IssueTree.create(repo, issues)
icommit = IssueCommit.create(repo, commit, itree)
write_last_issue(repo.issue_dir, commit.hexsha)

if icommit.open_issues > 0:
    result = str(icommit.open_issues) + \
        ' Open Issues @' + repo.active_branch.name
    print(colored(result, 'red', attrs=['bold']))
else:
    result = 'No Open Issues @' + repo.active_branch.name
    print(colored(result, 'green', attrs=['bold']))
